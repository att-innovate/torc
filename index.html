<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="Documentation - ToRC Reference Architecture">
        
        <link rel="canonical" href="http://att-innovate.github.io/torc/">
        <link rel="shortcut icon" href="./img/favicon.ico">

	<title>ToRC</title>

        <link href="./css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="./css/font-awesome-4.0.3.css" rel="stylesheet">
        <link rel="stylesheet" href="./css/highlight.css">
        <link href="./css/base.css" rel="stylesheet">

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-80815593-1', 'auto');
            ga('send', 'pageview');
        </script>
        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href=".">ToRC</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li class="active">
                    <a href=".">Home</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Installation <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="installation/installation/">Overview</a>
</li>

                    
                        
<li >
    <a href="installation/wedge/">Provision Wedge</a>
</li>

                    
                        
<li >
    <a href="installation/snaproute/">Configure SnapRoute</a>
</li>

                    
                        
<li >
    <a href="installation/torc-core/">Install ToRC Core</a>
</li>

                    
                        
<li >
    <a href="installation/compute/">Provision Compute Node</a>
</li>

                    
                        
<li >
    <a href="installation/scheduler/">Restart Scheduler</a>
</li>

                    
                        
<li >
    <a href="installation/explore/">Explore ToRC Services</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Example <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="example/dns/">DNS Infrastructure</a>
</li>

                    
                    </ul>
                </li>
            
            
            
                <li >
                    <a href="reference/">Reference</a>
                </li>
            
            
            
                <li >
                    <a href="construction/">Construction Sites</a>
                </li>
            
            
            
                <li >
                    <a href="softwarehardware/">Software / Hardware</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        
<li >
    <a href="about/team/">Team</a>
</li>

                    
                        
<li >
    <a href="about/license/">License</a>
</li>

                    
                    </ul>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i>
                    </a>
                </li>
                <li class="disabled">
                    <a rel="next" >
                        <i class="fa fa-arrow-left"></i>
                    </a>
                </li>
                <li >
                    <a rel="prev" href="installation/installation/">
                        <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/att-innovate/torc">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#torc-top-of-rack-controller">ToRC - Top of Rack Controller</a></li>
        
            <li><a href="#motivation">Motivation</a></li>
        
            <li><a href="#core-concepts">Core Concepts</a></li>
        
            <li><a href="#construction-sites">Construction Sites</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="torc-top-of-rack-controller">ToRC - Top of Rack Controller</h1>
<p>Low-Latency Computing at the Edge of the Network - Applications, Services, and Network Functions controlled by a Top-of-Rack Switch.</p>
<p><img alt="demo-reference-setup" src="./assets/demo-reference-setup.png" /></p>
<p>This project should serve as a blueprint, as a reference architecture for everyone interested in controlling resources in a compute rack from its TOR switch.</p>
<p>We open sourced all the scripts to set it up, plus all the software pieces written by us. A detailed list of all the projects can be found in the <a href="softwarehardware/">Software / Hardware</a> section.</p>
<p>And to not forget, all the code got written in a proof-of-concept context and therefore is not production-ready (yet).</p>
<h2 id="motivation">Motivation</h2>
<h3 id="computing-at-the-edge">Computing at the Edge</h3>
<p>The dynamic nature of ever increasing traffic over mobile networks requires highly reactive backends. Things like video-caching, anomaly detection, efficient bandwidth management, or even routing has to be handled much closer to the enduser, to the enduser device.</p>
<p>Low latency requirements of many mobile related use-cases makes every roundtrip to the central data-center inefficient or even impossible, especially for any control flows.</p>
<h3 id="micro-server-in-every-device">Micro-server in every device</h3>
<p>In 2015 Facebook announced that they have built their own network switch. We obviously got curious about the reasons behind that decision. Luckily some insides can be found in a related blog post: "<a href="https://code.facebook.com/posts/145488969140934/open-networking-advances-with-wedge-and-fboss/">Open networking advances with Wedge and FBOSS</a>”.</p>
<blockquote>
<p>Many network operators we've spoken with share our goal of <strong>managing our networking devices and servers in the same way</strong>. With that goal in mind, we designed both <strong>Wedge</strong> and <strong>FBOSS</strong> to closely resemble server hardware and server software, which has <strong>enabled us to deploy, monitor, and control these systems alongside our servers and storage</strong>.</p>
</blockquote>
<p>The disintegration in to individual dedicate hardware-components for switching and device management (BMC) allowed Facebook to use a regular off-the-shelf micro-server for the control-plane.</p>
<p>This Intel-based micro-server with 8gb RAM and 120gb SSD became the enabling piece for our ToRC architecture.</p>
<h3 id="build-ship-and-run-on-any-device">Build, ship, and run on any device</h3>
<p><a href="http://www.docker.com">Docker</a> changed the way we package, deploy, and run services. We are finally in a position where we can run the same package, the same container on a switch and a regular compute node independent of underlying Linux kernel and libraries. This simplifies and streamlines not just the deployment of services but also provides a unique opportunity to decide at run time where to place and run a service.</p>
<h3 id="metrics-driven-orchestration">Metrics-driven Orchestration</h3>
<h4 id="ease-of-metrics-collection">Ease of Metrics Collection</h4>
<p>Containers out of the box come with metrics (cpu, memory, network). For pretty much the first time we are able to easily collect metrics on a service level.</p>
<p>If we add metrics collected by the switch and metrics from the compute nodes and stream everything in to a time-series database we end up with the data needed for informed control, placement, and optimization decisions.</p>
<h4 id="orchestration-separation-of-concern">Orchestration - Separation of Concern</h4>
<p>It gets easily overlooked that controlling software running on an infrastructure level is different from controlling a 3-tier web application. Therefore many of the popular container-orchestrators are too limiting and can’t be used for our use-case.</p>
<p><a href="https://mesos.apache.org">Mesos</a> offers a unique and powerful separation between resource-management and orchestration/scheduling. Resource-management is done by Mesos and orchestration is handled by an individually implemented use-case specific scheduler, called Mesos-frameworks. Those Mesos-frameworks, like the “ToRC Scheduler”, provide a nice and easy way to encapsulate the logic needed to make informed control and placement decisions for specific use-cases and applications.</p>
<h2 id="core-concepts">Core Concepts</h2>
<p>A list of a few core concepts which serve as guiding principles for ToRC:</p>
<ul>
<li><a href=".#autonomous-rack">Federation of Autonomous Racks</a></li>
<li><a href=".#top-of-rack-controller">Top-of-Rack Controller</a></li>
<li><a href=".#no-virtualization-minimal-abstraction">No virtualization, minimal abstraction</a></li>
<li><a href=".#unified-view-across-network-and-compute-state">Unified view across network and compute state</a></li>
<li><a href=".#extensive-collection-of-metrics">Extensive collection of metrics</a></li>
<li><a href=".#selective-state-replication-selective-routing">Selective state replication, selective routing</a></li>
<li><a href=".#scheduler-hierarchy-control-placement-optimization">Scheduler Hierarchy, Control - Placement - Optimization</a></li>
</ul>
<h3 id="federation-of-autonomous-racks">Federation of Autonomous Racks</h3>
<p>Each rack serves as a self-contained “datacenter”. It has all the core control and network functions needed to work as an autonomous entity.</p>
<p>Each rack controls the visibility of its services and state.</p>
<p>Racks can be bundled in groups. Groups share state in an eventual consistent way.</p>
<h3 id="top-of-rack-controller">Top-of-Rack Controller</h3>
<p>The unique location of the Top-of-Rack switch and its importance for the whole rack makes it a perfect fit for any core controller functionality.</p>
<h3 id="no-virtualization-minimal-abstraction">No virtualization, minimal abstraction</h3>
<p>To guarantee low latency and high resource efficiency we avoid any virtualization technology like VM or Overlay Network. </p>
<p>Docker is used to run services and L3 routing for its networking. Each container has its own routable IP address.</p>
<p>Our code is written in Rust and Go. Both languages generate binary executables.</p>
<p>We carefully try to avoid any additional abstraction layer. Our code has to be able to benefit from each and every feature the underlying network or compute hardware offers. </p>
<h3 id="extensive-collection-of-metrics">Extensive collection of metrics</h3>
<p>Realtime metrics are key for efficient orchestration. We collect  system, network, and container metrics and store them in a time-series database. Each rack has its own time-series database.</p>
<h3 id="unified-view-across-network-and-compute-state">Unified view across network and compute state</h3>
<p>Each rack maintains one unified view across states of all its different services, and network and compute resources. </p>
<h3 id="selective-state-replication-selective-routing">Selective state replication, selective routing</h3>
<p>Only a subset of the state gets shared between racks using replication. If a scheduler decides that one of its services needs to be reachable from the other racks its route gets announced via the shared state.</p>
<h3 id="scheduler-hierarchy-control-placement-optimization">Scheduler Hierarchy, Control - Placement - Optimization</h3>
<p>We implemented a 3 layer scheduler hierarchy.</p>
<ul>
<li>The “ToRC Scheduler” runs on the switch and <strong>controls</strong> all the core services. It also handles all the interactions with the state database and the network-agent.</li>
<li>“Sub-schedulers” are responsible for the <strong>placement</strong> of services serving a specific use-case, like the <a href="example/dns/">DNS example</a>. “Sub-schedulers” provide updates to the ToRC Scheduler about the state, placement, and configuration of their services.</li>
<li>“Optimizers” constantly analyze the time-series data and the state of the rack. If they find a need for <strong>optimization</strong>, like scaling up a service or shutting off a node, they will interact with the correspondent scheduler to execute on those optimizations.</li>
</ul>
<h2 id="construction-sites">Construction Sites</h2>
<p>Please refer to <a href="construction/">Construction Sites</a> for areas of on-going and future implementation work.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            
                <center>© 2016 AT&T All Rights Reserved.</center>
            
            <center>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</center>
        </footer>

        <script src="./js/jquery-1.10.2.min.js"></script>
        <script src="./js/bootstrap-3.0.3.min.js"></script>
        <script src="./js/highlight.pack.js"></script>
        <script>var base_url = '.';</script>
        <script data-main="./mkdocs/js/search.js" src="./mkdocs/js/require.js"></script>
        <script src="./js/base.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                    </div>
                    <div class="modal-body">
                        <p>
                            From here you can search these documents. Enter
                            your search terms below.
                        </p>
                        <form role="form">
                            <div class="form-group">
                                <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                            </div>
                        </form>
                        <div id="mkdocs-search-results"></div>
                    </div>
                    <div class="modal-footer">
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>